<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <style type="text/css"> .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.external):nth-child(6) > .nav-list > .nav-list-item:nth-child(3) > .nav-list-link { display: block; font-weight: 600; text-decoration: none; background-image: linear-gradient(-90deg, #7fac15 0%, rgba(127, 172, 21, 0.8) 80%, rgba(127, 172, 21, 0) 100%); } .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.passive):nth-child(6) > .nav-list-expander svg, .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.passive):nth-child(6) > .nav-list > .nav-list-item:not(.passive):nth-child(3) > .nav-list-expander svg { transform: rotate(-90deg); } .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.passive):nth-child(6) > .nav-list, .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.passive):nth-child(6) > .nav-list > .nav-list-item:not(.passive):nth-child(3) > .nav-list { display: block; } .site-nav > .nav-category-list > .nav-list-item:not(.passive) > .nav-list-expander svg { transform: rotate(-90deg); } .site-nav > .nav-category-list > .nav-list-item:not(.passive) > .nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Creating custom kernels with IPython | PLEIADES User Documentation</title> <meta name="generator" content="Jekyll v4.3.2" /> <meta property="og:title" content="Creating custom kernels with IPython" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="User documentation for the PLEIADES cluster at the University of Wuppertal" /> <meta property="og:description" content="User documentation for the PLEIADES cluster at the University of Wuppertal" /> <link rel="canonical" href="http://localhost:4000/jupyter/jupyter-kernels.html" /> <meta property="og:url" content="http://localhost:4000/jupyter/jupyter-kernels.html" /> <meta property="og:site_name" content="PLEIADES User Documentation" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Creating custom kernels with IPython" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"User documentation for the PLEIADES cluster at the University of Wuppertal","headline":"Creating custom kernels with IPython","url":"http://localhost:4000/jupyter/jupyter-kernels.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> PLEIADES User Documentation </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Getting Started category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gettingstarted.html" class="nav-list-link">Getting Started</a><ul class="nav-list"><li class="nav-list-item"><a href="/gettingstarted/access.html" class="nav-list-link">Access</a></li><li class="nav-list-item"><a href="/gettingstarted/software.html" class="nav-list-link">Software & File Systems</a></li><li class="nav-list-item"><a href="/gettingstarted/computations.html" class="nav-list-link">Computations</a></li><li class="nav-list-item"><a href="/gettingstarted/zabbix.html" class="nav-list-link">Monitoring</a></li></ul></li><li class="nav-list-item"><a href="/hardware.html" class="nav-list-link">Hardware</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in File Systems category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/filesystem.html" class="nav-list-link">File Systems</a><ul class="nav-list"><li class="nav-list-item"><a href="/filesystem/BeeGFS.html" class="nav-list-link">BeeGFS</a></li><li class="nav-list-item"><a href="/filesystem/filetransfers.html" class="nav-list-link">Moving Data</a></li><li class="nav-list-item"><a href="/filesystem/bestpractices.html" class="nav-list-link">Best Practices</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Slurm category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/slurm.html" class="nav-list-link">Slurm</a><ul class="nav-list"><li class="nav-list-item"><a href="/slurm/basics.html" class="nav-list-link">Basics</a></li><li class="nav-list-item"><a href="/slurm/gpu.html" class="nav-list-link">Using GPUs</a></li><li class="nav-list-item"><a href="/slurm/exampleArray.html" class="nav-list-link">Job arrays</a></li><li class="nav-list-item"><a href="/slurm/exampleDeps.html" class="nav-list-link">Job dependencies</a></li><li class="nav-list-item"><a href="/slurm/exampleTmp.html" class="nav-list-link">Slurm example: Clean up tmp directory</a></li><li class="nav-list-item"><a href="/slurm/performance.html" class="nav-list-link">Job Performance</a></li><li class="nav-list-item"><a href="/slurm/bestpractices.html" class="nav-list-link">Best Practices</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Software on PLEIADES category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/software.html" class="nav-list-link">Software on PLEIADES</a><ul class="nav-list"><li class="nav-list-item"><a href="/software/avail.html" class="nav-list-link">Available Software</a></li><li class="nav-list-item"><a href="/software/modules.html" class="nav-list-link">Modules</a></li><li class="nav-list-item"><a href="/software/mpi.html" class="nav-list-link">MPI on PLEIADES</a></li><li class="nav-list-item"><a href="/software/containers.html" class="nav-list-link">Containers</a></li><li class="nav-list-item"><a href="/software/pgi.html" class="nav-list-link">PGI</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Jupyter category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/jupyter.html" class="nav-list-link">Jupyter</a><ul class="nav-list"><li class="nav-list-item"><a href="/jupyter/jupyterHub.html" class="nav-list-link">JupyterHub on PLEIADES</a></li><li class="nav-list-item"><a href="/jupyter/jupyter-nb_on_pleiades.html" class="nav-list-link">Custom Jupyter Notebooks on PLEIADES</a></li><li class="nav-list-item"><a href="/jupyter/jupyter-kernels.html" class="nav-list-link">Creating custom kernels with IPython</a></li></ul></li><li class="nav-list-item"><a href="/GridCertificates.html" class="nav-list-link">wLCG Grid Certificates</a></li><li class="nav-list-item"><a href="/PleiadesAcknowledgement.html" class="nav-list-link">PLEIADES Acknowledgement</a></li><li class="nav-list-item"><a href="/faq.html" class="nav-list-link">Frequently Answered Questions</a></li></ul> </nav> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search PLEIADES User Documentation" aria-label="Search PLEIADES User Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://pleiades.uni-wuppertal.de/" class="site-button" > Pleiades Webpage </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/jupyter.html">Jupyter</a></li> <li class="breadcrumb-nav-list-item"><span>Creating custom kernels with IPython</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h2 id="jupyter-creating-custom-kernels-with-ipython"> <a href="#jupyter-creating-custom-kernels-with-ipython" class="anchor-heading" aria-labelledby="jupyter-creating-custom-kernels-with-ipython"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Jupyter: Creating custom kernels with IPython </h2> <p>Virtual environments provide a way to create isolated and self-contained Python environments with their own set of packages and dependencies, making it easier to manage different projects without interference. In this section, we will explore the steps required to create a virtual environment using <em>pip</em> and <em>venv</em> or <em>Conda</em> and install the necessary packages for running JupyterLab with IPython kernels. These kernels can then be selected from the JupyterLab interface and will provide the associated virtual environment from within your JupyterLab session.</p> <p>As long as you want to have a virtual environment, which uses Python 3.10.4 (the Python version of JupyterHub), you can do all steps from within a JupyterLab session’s terminal. However, we highly suggest to follow our instructions while on one of the log in nodes or on a worker node. Usually, the latter should be preferred, as not to overload the log in nodes. Further, if no local Python installation is used for the kernel, the <code class="language-plaintext highlighter-rouge">module load</code> command should load a Python version with the affix <em>-bare</em>. This ensures, that virtual environments will be void of Python modules/packages upon creation (in particular the environment variable <em>PYTHONPATH</em> will remain empty).</p> <p>We first begin with instructions regarding IPython kernels based on Python 3.10.4. <strong>With the modular structure of PLEIADES’ software stack it is not trivial to utilize new IPython kernels for other Python versions than 3.10.4.</strong> Nevertheless, at the end of this section we provide instructions on how to generate IPython kernels for arbitray Python versions (supported by IPython) through <em>pip</em> and <em>venv</em> only. They require some additional modifications in the <em>kernel.json</em> file and correct Python paths. We do not provide support for such custom kernels and therefore user caution is advised.</p> <h3 id="jupyterhub-virtual-environments-with-pip-for-custom-ipython-kernels-with-python-3104"> <a href="#jupyterhub-virtual-environments-with-pip-for-custom-ipython-kernels-with-python-3104" class="anchor-heading" aria-labelledby="jupyterhub-virtual-environments-with-pip-for-custom-ipython-kernels-with-python-3104"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> JupyterHub: Virtual environments with pip for custom IPython kernels (with Python 3.10.4) </h3> <p>Before you start, you need to make sure, that you have Python version 3.10.4 loaded inside your current environment. If you do not have a Python 3.10.4 of your own, you can simply load it through one of the <code class="language-plaintext highlighter-rouge">module</code>s provided by the Scientific Computing Center PLEIADES. You can make sure you are using the desired Python binaries through <code class="language-plaintext highlighter-rouge">which python</code> and the version through <code class="language-plaintext highlighter-rouge">python --version</code>. Once ready, do the following to customize your virtual environment:</p> <ol> <li>Generate the virtual environment: <code class="language-plaintext highlighter-rouge">python -m venv &lt;name_of_virtual_env&gt;</code></li> <li>Activate the virtual environment: <code class="language-plaintext highlighter-rouge">source /pathToVirtualEnvironment/bin/activate</code></li> <li>Install the <em>ipykernel</em> package into the virtual environment: <code class="language-plaintext highlighter-rouge">python -m pip install ipykernel</code></li> <li>Install any other required packages through <em>pip</em>: <code class="language-plaintext highlighter-rouge">python -m pip install &lt;package1&gt; &lt;package2&gt; ... &lt;packageN&gt;</code></li> <li>Use the <em>ipykernel</em> package to install a new IPython kernel for JupyterLab servers: <br /> <code class="language-plaintext highlighter-rouge">python -m ipykernel install --user --name 'NameOfKernelALPHANUMERICAL' --display-name "Name of kernel displayed in Jupyter"</code></li> <li>To not further mess with your kernel you should deactivate the corresponding virtual environment: <code class="language-plaintext highlighter-rouge">deactivate</code></li> </ol> <p>After the activation of a virtual environment in <strong>step 2</strong>, you should see the name of the environment next to your usual prompt of the CLI, e.g. <code class="language-plaintext highlighter-rouge">(name_of_virtual_env) -bash-4.2$</code>. Likewise, the name of the environment should disappear after <strong>step 6</strong>. Once a kernel has been created in <strong>step 5</strong>, you should almost immediately have it available in any (even already running) JupyterLab server. More importantly, you can continue modifying your custom kernel simply by sourcing its virtual environment (<strong>step 2</strong>) and then repeating <strong>step 4</strong> as much as you need to.<br /> The command from <strong>step 5</strong> installs your kernel into your local directory at <code class="language-plaintext highlighter-rouge">~/.local/share/jupyter/kernels</code>. Jupyter automatically checks this directory and makes these kernels available to the user through the JupyterLab interface.</p> <h3 id="jupyterhub-virtual-environments-with-conda-for-custom-ipython-kernels-with-python-3104"> <a href="#jupyterhub-virtual-environments-with-conda-for-custom-ipython-kernels-with-python-3104" class="anchor-heading" aria-labelledby="jupyterhub-virtual-environments-with-conda-for-custom-ipython-kernels-with-python-3104"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> JupyterHub: Virtual environments with Conda for custom IPython kernels (with Python 3.10.4) </h3> <p>If you prefer to manage your packages and virtual environments with Conda, you can do this, aswell. To activate the basic Conda environment <em>(base)</em> do the following:</p> <ol> <li>Open a terminal in your JupyterLab server: <em>File-&gt;New-&gt;Terminal</em></li> <li>In the terminal enter <code class="language-plaintext highlighter-rouge">conda activate</code>. Afterwards you should see a <em>(base)</em> before the prompt indicating that you are in the <em>base</em> environment.</li> </ol> <p>You can deactivate this environment, like any conda environment, by typing <code class="language-plaintext highlighter-rouge">conda deactivate</code>. To disable the automatic activation of the <em>base</em> environment enter <code class="language-plaintext highlighter-rouge">conda config --set auto_activate_base false</code>.</p> <p>Often users are not interested in using only the <em>base</em> environment in order to prevent conflicts between differrent packages. In order to configure your own environment with packages and use it within any of your JupyterLab servers, follow these steps:</p> <ol> <li>Create your conda environment: <code class="language-plaintext highlighter-rouge">conda create --name &lt;name_of_virtual_env&gt;</code></li> <li>Activate it (from anywhere): <code class="language-plaintext highlighter-rouge">conda activate &lt;name_of_virtual_env&gt;</code></li> <li>Install any packages you like <strong>through conda</strong></li> <li>Install the <em>ipykernel</em> package in the chosen conda virtual environment: <code class="language-plaintext highlighter-rouge">conda install ipykernel</code></li> <li>Enable the kernel: <code class="language-plaintext highlighter-rouge">python -m ipykernel install --user --name 'Name-of-my-venv' --display-name "Displayed name of my venv"</code></li> <li>Start a new Jupyter notebook: <em>File-&gt;New-&gt;Notebook</em></li> <li>Select your kernel from the dropdown menu according to your option <code class="language-plaintext highlighter-rouge">--display-name</code> from point 5</li> </ol> <p>If you prefer, you can also install the kernels while directly logged in to PLEIADES instead of the JupyterHub log in.</p> <h3 id="jupyterhub-virtual-environments-with-pip-for-custom-ipython-kernels-other-python-versions"> <a href="#jupyterhub-virtual-environments-with-pip-for-custom-ipython-kernels-other-python-versions" class="anchor-heading" aria-labelledby="jupyterhub-virtual-environments-with-pip-for-custom-ipython-kernels-other-python-versions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> JupyterHub: Virtual environments with pip for custom IPython kernels (other Python versions) </h3> <p>Utilizing kernels with a Python version other than 3.10.4 will result in the kernel not properly loading displayed in the JupyterLab interface as <em>disconnected</em>. This originates in the modules loaded for JupyterLab server start-up, which cause conflicts with other python libraries.<br /> To generate an IPython kernel for an arbitrary Python version you can initially proceed as you would for a custom IPython kernel with Python 3.10.4:</p> <ol> <li>Generate the virtual environment: <code class="language-plaintext highlighter-rouge">python -m venv &lt;name_of_virtual_env&gt;</code></li> <li>Activate the virtual environment: <code class="language-plaintext highlighter-rouge">source /pathToVirtualEnvironment/bin/activate</code></li> <li>Install the <em>ipykernel</em> package into the virtual environment: <code class="language-plaintext highlighter-rouge">python -m pip install ipykernel</code></li> <li>Install any other required packages through <em>pip</em>: <code class="language-plaintext highlighter-rouge">python -m pip install &lt;package1&gt; &lt;package2&gt; ... &lt;packageN&gt;</code></li> <li>Use the <em>ipykernel</em> package to install a new IPython kernel for JupyterLab servers: <br /> <code class="language-plaintext highlighter-rouge">python -m ipykernel install --user --name 'NameOfKernelALPHANUMERICAL' --display-name "Name of kernel displayed in Jupyter"</code></li> <li>To not further mess with your kernel you should deactivate the corresponding virtual environment: <code class="language-plaintext highlighter-rouge">deactivate</code></li> </ol> <p>Comments on some of these steps are provided further above in the <a href="#jupyterhub:-virtual-environments-with-pip-for-custom-ipython-kernels-(with-python-3.10.4)">corresponding section</a>.<br /> Afterwards, follow these steps (we will use an IPython kernel based on Python 3.9.5 as an example):</p> <ol> <li>Go to the location of your kernel (usually something like <code class="language-plaintext highlighter-rouge">~/.local/share/jupyter/kernels/NameOfKernelALPHANUMERICAL</code>)</li> <li>Change the argument vector (<code class="language-plaintext highlighter-rouge">argv</code>) in <code class="language-plaintext highlighter-rouge">kernel.json</code> from something like this: <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
 "argv": [
  "/pathToVirtualEnvironment/bin/python",
  "-m",
  "ipykernel_launcher",
  "-f",
  "{connection_file}"
 ],
 "display_name": "Name of kernel displayed in Jupyter",
 "language": "python",
 "metadata": {
  "debugger": true
 }
}
</code></pre></div> </div> <p>to something like this:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
 "argv": [
  "~/.local/share/jupyter/kernels/NameOfKernelALPHANUMERICAL/initKernel.sh",
  "-f",
  "{connection_file}"
 ], 
"display_name": "Name of kernel displayed in Jupyter",
 "language": "python",
 "metadata": {
  "debugger": true
 }
}
</code></pre></div> </div> <p>Note, that you only change the content of <code class="language-plaintext highlighter-rouge">argv</code> and nothing else in that file. The argument vector will now point to a file <code class="language-plaintext highlighter-rouge">initKernel.sh</code>, which will be executed at the start up of the kernel.</p> </li> <li>Create the file <code class="language-plaintext highlighter-rouge">initKernel.sh</code> in <code class="language-plaintext highlighter-rouge">~/.local/share/jupyter/kernels/NameOfKernelALPHANUMERICAL/</code> based on the following content: <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>
<span class="c"># Get rid of any modules loaded by JupyterHub / JupyterLab</span>
module purge
<span class="c"># Load the same modules which you have loaded</span>
<span class="c"># for the creation of the virtual environment.</span>
<span class="c"># If you are using your own insallation of Python</span>
<span class="c"># without any modules then you have to leave </span>
<span class="c"># the next line empty.</span>
module load 2022a  GCCcore/11.3.0 Python/3.9.5-bare
<span class="c"># This is CRITICAL and should ALWAYS be at the end of your script</span>
<span class="nb">exec</span> /pathToVirtualEnvironment/bin/python <span class="nt">-m</span> ipykernel <span class="nv">$@</span>
</code></pre></div> </div> </li> </ol> <p>Keep in mind that the additional loading of modules in <code class="language-plaintext highlighter-rouge">initKernel.sh</code> might take some time. Keep an eye out on the kernel status, and once it states <em>idle</em>, you can start working.</p> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
