<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <style type="text/css"> .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.external):nth-child(5) > .nav-list > .nav-list-item:nth-child(3) > .nav-list-link { display: block; font-weight: 600; text-decoration: none; background-image: linear-gradient(-90deg, #7fac15 0%, rgba(127, 172, 21, 0.8) 80%, rgba(127, 172, 21, 0) 100%); } .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.passive):nth-child(5) > .nav-list-expander svg, .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.passive):nth-child(5) > .nav-list > .nav-list-item:not(.passive):nth-child(3) > .nav-list-expander svg { transform: rotate(-90deg); } .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.passive):nth-child(5) > .nav-list, .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.passive):nth-child(5) > .nav-list > .nav-list-item:not(.passive):nth-child(3) > .nav-list { display: block; } .site-nav > .nav-category-list > .nav-list-item:not(.passive) > .nav-list-expander svg { transform: rotate(-90deg); } .site-nav > .nav-category-list > .nav-list-item:not(.passive) > .nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>MPI on PLEIADES | PLEIADES User Documentation</title> <meta name="generator" content="Jekyll v4.3.2" /> <meta property="og:title" content="MPI on PLEIADES" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="User documentation for the PLEIADES cluster at the University of Wuppertal" /> <meta property="og:description" content="User documentation for the PLEIADES cluster at the University of Wuppertal" /> <link rel="canonical" href="http://localhost:4000/software/mpi.html" /> <meta property="og:url" content="http://localhost:4000/software/mpi.html" /> <meta property="og:site_name" content="PLEIADES User Documentation" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="MPI on PLEIADES" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"User documentation for the PLEIADES cluster at the University of Wuppertal","headline":"MPI on PLEIADES","url":"http://localhost:4000/software/mpi.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> PLEIADES User Documentation </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Getting Started category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gettingstarted.html" class="nav-list-link">Getting Started</a><ul class="nav-list"><li class="nav-list-item"><a href="/gettingstarted/access.html" class="nav-list-link">Access</a></li><li class="nav-list-item"><a href="/gettingstarted/software.html" class="nav-list-link">Software & File Systems</a></li><li class="nav-list-item"><a href="/gettingstarted/computations.html" class="nav-list-link">Computations</a></li><li class="nav-list-item"><a href="/gettingstarted/zabbix.html" class="nav-list-link">Monitoring</a></li></ul></li><li class="nav-list-item"><a href="/hardware.html" class="nav-list-link">Hardware</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in File Systems category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/filesystem.html" class="nav-list-link">File Systems</a><ul class="nav-list"><li class="nav-list-item"><a href="/filesystem/BeeGFS.html" class="nav-list-link">BeeGFS</a></li><li class="nav-list-item"><a href="/filesystem/filetransfers.html" class="nav-list-link">Moving Data</a></li><li class="nav-list-item"><a href="/filesystem/bestpractices.html" class="nav-list-link">Best Practices</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Slurm category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/slurm.html" class="nav-list-link">Slurm</a><ul class="nav-list"><li class="nav-list-item"><a href="/slurm/basics.html" class="nav-list-link">Basics</a></li><li class="nav-list-item"><a href="/slurm/gpu.html" class="nav-list-link">Using GPUs</a></li><li class="nav-list-item"><a href="/slurm/exampleArray.html" class="nav-list-link">Job arrays</a></li><li class="nav-list-item"><a href="/slurm/exampleDeps.html" class="nav-list-link">Job dependencies</a></li><li class="nav-list-item"><a href="/slurm/exampleTmp.html" class="nav-list-link">Slurm example: Clean up tmp directory</a></li><li class="nav-list-item"><a href="/slurm/performance.html" class="nav-list-link">Job Performance</a></li><li class="nav-list-item"><a href="/slurm/bestpractices.html" class="nav-list-link">Best Practices</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Software on PLEIADES category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/software.html" class="nav-list-link">Software on PLEIADES</a><ul class="nav-list"><li class="nav-list-item"><a href="/software/avail.html" class="nav-list-link">Available Software</a></li><li class="nav-list-item"><a href="/software/modules.html" class="nav-list-link">Modules</a></li><li class="nav-list-item"><a href="/software/mpi.html" class="nav-list-link">MPI on PLEIADES</a></li><li class="nav-list-item"><a href="/software/containers.html" class="nav-list-link">Containers</a></li><li class="nav-list-item"><a href="/software/pgi.html" class="nav-list-link">PGI</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Jupyter category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/jupyter.html" class="nav-list-link">Jupyter</a><ul class="nav-list"><li class="nav-list-item"><a href="/jupyter/jupyterHub.html" class="nav-list-link">JupyterHub on PLEIADES</a></li><li class="nav-list-item"><a href="/jupyter/jupyter-nb_on_pleiades.html" class="nav-list-link">Custom Jupyter Notebooks on PLEIADES</a></li><li class="nav-list-item"><a href="/jupyter/jupyter-kernels.html" class="nav-list-link">Creating custom kernels with IPython</a></li></ul></li><li class="nav-list-item"><a href="/GridCertificates.html" class="nav-list-link">wLCG Grid Certificates</a></li><li class="nav-list-item"><a href="/PleiadesAcknowledgement.html" class="nav-list-link">PLEIADES Acknowledgement</a></li><li class="nav-list-item"><a href="/faq.html" class="nav-list-link">Frequently Answered Questions</a></li></ul> </nav> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search PLEIADES User Documentation" aria-label="Search PLEIADES User Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://pleiades.uni-wuppertal.de/" class="site-button" > Pleiades Webpage </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/software.html">Software on PLEIADES</a></li> <li class="breadcrumb-nav-list-item"><span>MPI on PLEIADES</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h2 id="software-mpi-on-pleiades"> <a href="#software-mpi-on-pleiades" class="anchor-heading" aria-labelledby="software-mpi-on-pleiades"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Software: MPI on PLEIADES </h2> <p>There are multiple MPI environments available:</p> <ol> <li>OpenMPI4: <code class="language-plaintext highlighter-rouge">module load 2021a GCC/10.3.0 OpenMPI/4.1.1</code></li> <li>Intel MPI: <code class="language-plaintext highlighter-rouge">module load 2021a iimpi/2021a</code> (oneAPI) or through Parallel Studio with <code class="language-plaintext highlighter-rouge">source /beegfs/Tools/intel/setup.sh</code> (Version from 2020)</li> <li>Local package OpenMPI3 in <code class="language-plaintext highlighter-rouge">/lib64/openmpi3</code> on our worker nodes</li> <li>Compiling your own MPI libraries</li> <li>LCG release (See last section of <a href="/software/modules.html">modules</a>, <strong>not using InfiniBand</strong>)</li> </ol> <p>All MPI versions were tested on PLEIADES with an MPI benchmark. These tests covered the mpirun and srun approach (see below), as well as ethernet and infiniband communication.</p> <p>Many problems with MPI are caused by a mismatch between the applications expected MPI version/configuration and the used MPI version in your environment. If you experience problems, try a clean build and investigate MPI related options during your application build and at runtime.</p> <p><strong>When compiling your own MPI</strong>, make sure to send a build job to the worker nodes and provide the <code class="language-plaintext highlighter-rouge">--with-ucx</code> flag (and possibly more!). Otherwise your MPI version is likely to not utilize our InfiniBand network and rely on ethernet communication instead.</p> <h3 id="pmi-library"> <a href="#pmi-library" class="anchor-heading" aria-labelledby="pmi-library"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> PMI Library </h3> <p>The PMI library acts as an interface between Slurm and various MPI versions. This way Slurm can manage MPI processes, if the MPI library has been compiled correctly, e.g. by using <code class="language-plaintext highlighter-rouge">--with-pmi</code> and <code class="language-plaintext highlighter-rouge">--with-slurm</code>. If you intend to compile your own MPI versions, you may have to mention the location of PMI libraries:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># find /lib64/ -name libpmi*
/lib64/libpmi.so.1.0.1
/lib64/libpmi.la
/lib64/libpmi.so
/lib64/libpmi2.la
/lib64/libpmi2.so
/lib64/libpmi.so.1
/lib64/libpmi2.so.1
/lib64/libpmi2.so.1.0.0
/lib64/libpmix.la
/lib64/libpmix.so
/lib64/libpmix.so.2.2.32
/lib64/libpmix.so.2
</code></pre></div></div> <p>These paths may also become relevant if you use Intel MPI.</p> <h3 id="using-mpi-in-slurm-jobs"> <a href="#using-mpi-in-slurm-jobs" class="anchor-heading" aria-labelledby="using-mpi-in-slurm-jobs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using MPI in Slurm Jobs </h3> <p>There are two approaches to use MPI in your Slurm batch scripts:</p> <ol> <li><code class="language-plaintext highlighter-rouge">srun</code></li> <li><code class="language-plaintext highlighter-rouge">mpirun</code></li> </ol> <p><code class="language-plaintext highlighter-rouge">srun</code> is by default executing <code class="language-plaintext highlighter-rouge">srun --mpi=pmix_v3</code>, which may require your software to be build against PMIx, available as mentioned above. Alternative PMI options can be listed with <code class="language-plaintext highlighter-rouge">srun --mpi=list</code></p> <p>Applications that implicitly ship MPI may need additional configuration, e.g. enabling slurm support or pointing to PMI libraries. This is a case-by-case situation where you should study the corresponding documentation of your application.</p> <p>Consider reading the <a href="https://slurm.schedmd.com/mpi_guide.html">Slurm MPI documentation</a>.</p> <p>Deciding on the number of nodes, processes and cores per process can confusing sometimes. Use <code class="language-plaintext highlighter-rouge">srun --cpu-bind=help</code> to show available options to bind CPU resources managed by Slurm to your (MPI-)processes and have a look at the <a href="https://slurm.schedmd.com/cpu_management.html">Slurm CPU Management guide</a>.</p> <h3 id="example-job-script-with-openmpi-4"> <a href="#example-job-script-with-openmpi-4" class="anchor-heading" aria-labelledby="example-job-script-with-openmpi-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example Job Script with OpenMPI 4 </h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="c">#SBATCH -p short</span>
<span class="c">#SBATCH -t 60</span>
<span class="c">#SBATCH -N 4 # 4 Nodes</span>
<span class="c">#SBATCH -n 4 # 4 processes in total</span>

module load 2021a GCC/10.3.0 OpenMPI/4.1.1

<span class="c"># Option one:</span>
srun <span class="nt">--mpi</span><span class="o">=</span>pmix_v3 /path/to/mpiapplication &lt;arguments&gt;

<span class="c"># Or using mpirun directly:</span>
mpirun /path/to/mpiapplication &lt;arguments&gt;
</code></pre></div></div> <p>It is possible to pass <code class="language-plaintext highlighter-rouge">--mca</code> options in these commands as well.</p> <h3 id="notes-on-intel-mpi"> <a href="#notes-on-intel-mpi" class="anchor-heading" aria-labelledby="notes-on-intel-mpi"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Notes on Intel MPI </h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="c">#SBATCH -p short</span>
<span class="c">#SBATCH -t 60</span>
<span class="c">#SBATCH -N 4 # 4 Nodes</span>
<span class="c">#SBATCH -n 4 # 4 processes in total</span>

<span class="c"># Chose ONE of the following:</span>
<span class="c"># Use recent version of oneAPI impi</span>
module load 2021a iimpi/2021a
<span class="c"># Alternatively use impi shipped with Parallel Studio 2020</span>
<span class="nb">source</span> /beegfs/Tools/intel/setup.sh

<span class="c"># Tell impi where to pick up the PMI library, paths above.</span>
<span class="c"># Maybe try libpmix.so or libpmi2.so, if you have problems</span>
<span class="nb">export </span><span class="nv">I_MPI_PMI_LIBRARY</span><span class="o">=</span>/usr/lib64/libpmi.so

<span class="c"># Option one:</span>
srun <span class="nt">--mpi</span><span class="o">=</span>pmix_v3 /path/to/mpiapplication &lt;arguments&gt;
<span class="c"># Or using mpirun directly:</span>
mpirun /path/to/mpiapplication &lt;arguments&gt;
<span class="c"># Third option through the hydra process manager</span>
mpiexec.hydra <span class="nt">-bootstrap</span> slurm <span class="nt">-n</span> &lt;num_procs&gt; /path/to/mpiapplication &lt;arguments&gt;
</code></pre></div></div> <h3 id="local-openmpi-3"> <a href="#local-openmpi-3" class="anchor-heading" aria-labelledby="local-openmpi-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Local OpenMPI 3 </h3> <p>If you need more information about the locally installed OpenMPI 3 version, you can look around a worker node by</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Look into local openmpi3 manually on WN</span>
<span class="nv">$ </span>salloc <span class="nt">-N1</span> <span class="nt">-n1</span>
<span class="nv">$ </span>ssh wn21123 <span class="c"># replace with correct wn number of your interaction session</span>
<span class="nv">$ </span>yum info openmpi3
<span class="nv">$ </span><span class="nb">ls</span> /lib64/openmpi3
<span class="nv">$ </span>&lt;ctrl-d to <span class="nb">exit </span>salloc&gt;
</code></pre></div></div> <p>Alternatively, if you are just interested in file locations:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>srun <span class="nt">-N1</span> <span class="nt">-n1</span> tree /lib64/openmpi3 | less
</code></pre></div></div> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
